<ion-header class="ion-no-border">
  <ion-toolbar color="transparent">
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false" color="light"></ion-menu-button>
    </ion-buttons>
    <ion-title>Reminders</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openAddReminderModal()">
        <ion-icon slot="icon-only" name="add-circle-outline" color="primary"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <ion-toolbar color="transparent" *ngIf="!isLoading && pets.length > 0">
    <ion-segment [value]="selectedFilter" (ionChange)="filterChanged($event)" mode="md" scrollable>
      <ion-segment-button value="all">
        <ion-label>All Pets</ion-label>
      </ion-segment-button>
      <ion-segment-button *ngFor="let pet of pets" [value]="pet.id">
        <ion-label>{{ pet.name }}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <div *ngIf="!isLoading && allReminders.length === 0" class="empty-state">
    <ion-icon name="alarm-outline"></ion-icon>
    <ion-label>No reminders found</ion-label>
    <ion-text color="medium">
      <p>Tap the '+' button in the top right to add one.</p>
    </ion-text>
  </div>

  <ion-list *ngIf="!isLoading && allReminders.length > 0" lines="none" class="reminders-list">
    
    <ion-item-sliding *ngFor="let reminder of filteredReminders">
      <ion-item>
        <ion-icon name="alarm-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h2>{{ reminder.title }}</h2>
          <p>
            {{ reminder.due_date | date:'longDate' }}
            <span *ngIf="reminder.due_time"> at {{ reminder.due_time | date:'shortTime' }}</span>
          </p>
          <p *ngIf="reminder.recurrence !== 'none'" class="recurrence">
            (Repeats: {{ reminder.recurrence | titlecase }})
          </p>
          <p *ngIf="selectedFilter === 'all'" class="pet-name-badge">
            {{ getPetName(reminder.pet_id) }}
          </p>
        </ion-label>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="onDelete(reminder.id)">
          <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>

    <div *ngIf="filteredReminders.length === 0" class.empty-state-filter>
      <ion-text color="medium">No reminders found for this filter.</ion-text>
    </div>
  </ion-list>

</ion-content>